<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KenShoku - Product Information</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
  --bg: #020617;
  --surface: rgba(15, 23, 42, 0.96);
  --surface-soft: rgba(15, 23, 42, 0.9);
  --border-subtle: rgba(148,163,184,0.45);
  --border-strong: rgba(148,163,184,0.75);

  --accent: #22c55e;
  --accent-soft: rgba(34,197,94,0.18);
  --accent-strong: #16a34a;

  --info: #0284c7;
  --info-soft: rgba(59,130,246,0.2);

  --warning: #facc15;
  --warning-soft: rgba(250,204,21,0.2);

  --danger: #ef4444;

  --text-primary: #e5e7eb;
  --text-muted: #9ca3af;
  --text-soft: #6b7280;
}

/* RESET */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

/* FULL SCREEN BODY */
body {
  font-family: 'Inter', system-ui;
  background: radial-gradient(circle at top, rgba(34,197,94,0.28), transparent 55%),
              radial-gradient(circle at bottom, rgba(56,189,248,0.22), transparent 60%),
              #020617;

  min-height: 100vh;
  width: 100vw;
  overflow-x: hidden;

  padding: 48px 60px; /* Large screen spacing */
  color: var(--text-primary);
  position: relative;

  display: flex;
  flex-direction: column;
}

/* GRID + ORBS (Next.js aesthetic) */
.grid-overlay {
  position: fixed;
  inset: 0;
  background-image:
    linear-gradient(rgba(148,163,184,0.08) 1px, transparent 1px),
    linear-gradient(90deg, rgba(148,163,184,0.08) 1px, transparent 1px);
  background-size: 42px 42px;
  mask-image: radial-gradient(circle 78% at center, black 40%, transparent 100%);
  opacity: 0.45;
  z-index: 0;
}

.orb {
  position: fixed;
  filter: blur(60px);
  border-radius: 999px;
  opacity: 0.5;
  z-index: 0;
}

.orb-1 {
  top: -5%;
  right: 12%;
  width: 420px;
  height: 420px;
  background: radial-gradient(circle, rgba(34,197,94,0.45), transparent 70%);
}

.orb-2 {
  bottom: -10%;
  left: 5%;
  width: 400px;
  height: 400px;
  background: radial-gradient(circle, rgba(56,189,248,0.38), transparent 70%);
}

/* MAIN PAGE SHELL — FULL WIDTH */
.container {
  position: relative;
  z-index: 5;

  width: 100%;
  max-width: 100% !important;

  background: var(--surface);
  padding: 40px 44px;
  border-radius: 28px;

  backdrop-filter: blur(26px) saturate(180%);
  border: 1px solid var(--border-subtle);

  box-shadow:
    0 0 0 1px rgba(15,23,42,0.92),
    0 32px 90px rgba(15,23,42,0.96),
    0 0 160px rgba(34,197,94,0.22);
}

/* HEADER BLOCK */
.header {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.title-block {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

h1 {
  font-size: 38px;
  font-weight: 800;
  letter-spacing: -0.02em;

  background: linear-gradient(120deg, #fff, #bbf7d0, #22c55e);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.subtitle {
  font-size: 14px;
  color: var(--text-muted);
}

/* AI PILL */
.pill {
  padding: 8px 14px;
  border-radius: 999px;

  background: radial-gradient(circle at 0 0, rgba(34,197,94,0.4), transparent 60%),
              rgba(15,23,42,0.85);

  border: 1px solid rgba(34,197,94,0.6);
  color: #bbf7d0;
  font-size: 13px;
  font-weight: 600;

  display: inline-flex;
  align-items: center;
  gap: 6px;

  box-shadow:
    0 0 0 1px rgba(34,197,94,0.4),
    0 0 40px rgba(34,197,94,0.35);
}

.pill-dot {
  width: 8px;
  height: 8px;
  border-radius: 999px;
  background: var(--accent);
  box-shadow: 0 0 12px var(--accent);
}

/* IMAGE */
.product-image-container {
  width: 340px;
  height: 340px;
  margin: 26px 0;
  border-radius: 22px;

  overflow: hidden;
  position: relative;

  border: 1px solid var(--border-strong);

  background: radial-gradient(circle at top, rgba(15,23,42,0.55), rgba(15,23,42,1));

  box-shadow:
    0 28px 80px rgba(15,23,42,1),
    0 0 100px rgba(15,23,42,1);
}

.product-image-container:hover .product-image {
  transform: scale(1.06);
}

.product-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: 0.5s ease-out;
}

/* TEXT BLOCK */
.product-name {
  font-size: 26px;
  font-weight: 600;
  margin-bottom: 4px;
}

.product-meta {
  font-size: 14px;
  color: var(--text-soft);
  margin-bottom: 22px;
}

/* AI SUMMARY */
.ai-summary-box {
  background: radial-gradient(circle at 0 0, var(--accent-soft), transparent 60%),
              var(--surface-soft);

  border: 1px solid rgba(34,197,94,0.6);
  border-radius: 18px;

  padding: 20px;
  margin-bottom: 22px;

  box-shadow:
    0 0 0 1px rgba(34,197,94,0.3),
    0 26px 60px rgba(15,23,42,0.95);
}

.ai-summary-header {
  display: flex;
  align-items: center;
  gap: 8px;

  color: #bbf7d0;
  font-size: 15px;
  font-weight: 600;

  margin-bottom: 8px;
}

.ai-summary-text {
  color: var(--text-primary);
  font-size: 15px;
  line-height: 1.65;
}

/* ALTERNATIVES BOX */
.alternatives-box {
  background: radial-gradient(circle at 0 0, var(--warning-soft), transparent 60%),
              var(--surface-soft);

  border: 1px solid rgba(250,204,21,0.7);
  border-radius: 18px;

  padding: 20px;
  margin-bottom: 24px;

  box-shadow:
    0 0 0 1px rgba(250,204,21,0.4),
    0 26px 60px rgba(15,23,42,0.95);
}

.alternatives-header {
  font-size: 15px;
  font-weight: 600;
  color: var(--warning);
  display: flex;
  align-items: center;
  gap: 8px;
}

/* INFO SECTION */
.info-section {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.info-box {
  padding: 16px 18px;
  border-radius: 16px;

  border: 1px solid var(--border-subtle);

  background: radial-gradient(circle at top left, rgba(30,58,138,0.15), transparent 60%),
              rgba(15,23,42,0.95);

  box-shadow: 
    0 18px 45px rgba(15,23,42,0.95),
    0 0 60px rgba(15,23,42,1);

  transition: all 0.2s ease-out;
}

.info-box:hover {
  transform: translateY(-2px);
  border-color: rgba(148,163,184,0.85);
  box-shadow:
    0 22px 60px rgba(15,23,42,1);
}

.info-box.ingredients { border-left: 3px solid var(--accent); }
.info-box.allergens   { border-left: 3px solid #f97316; }
.info-box.calories    { border-left: 3px solid var(--info); }

.info-box strong {
  font-size: 15px;
  color: #fff;
}

.info-content {
  margin-top: 6px;
  font-size: 14px;
  color: var(--text-muted);
  line-height: 1.65;
}

/* BUTTON */
.button-container {
  margin-top: 28px;
  display: flex;
}

.button {
  padding: 14px 28px;
  border-radius: 999px;
  border: none;

  background: linear-gradient(120deg, #22c55e, #16a34a);
  color: white;
  font-size: 15px;
  font-weight: 600;

  display: flex;
  align-items: center;
  gap: 10px;

  cursor: pointer;
  transition: 0.2s;
  box-shadow:
    0 0 0 1px rgba(34,197,94,0.6),
    0 18px 45px rgba(34,197,94,0.45);
}

.button:hover {
  transform: translateY(-2px);
  box-shadow:
    0 0 0 1px rgba(34,197,94,0.9),
    0 26px 60px rgba(34,197,94,0.65);
}

/* FOOTER */
.footer {
  margin-top: 28px;
  font-size: 13px;
  color: var(--text-soft);
}

/* RESPONSIVE */
@media (max-width: 720px) {
  body {
    padding: 20px;
  }

  .container {
    padding: 28px 22px;
  }

  .product-image-container {
    width: 260px;
    height: 260px;
  }

  h1 {
    font-size: 28px;
  }
}

  </style>
</head>
<body>
  <div class="grid-overlay"></div>
  <div class="orb orb-1"></div>
  <div class="orb orb-2"></div>

  <div class="container">
    <div class="header">
      <div class="title-block">
        <h1>Product insight</h1>
        <p class="subtitle">Quick, personalized analysis based on your profile.</p>
      </div>
      <div class="pill">
        <span class="pill-dot"></span>
        AI Nutrition Snapshot
      </div>
    </div>

    <div class="product-image-container">
      {% if product.get('image_url') %}
        <img src="{{ product.get('image_url') }}" alt="Product Image" class="product-image">
      {% else %}
        <img src="/get_captured_image" alt="Captured Food Image" class="product-image">
      {% endif %}
    </div>

    <p class="product-name">{{ product.get('product_name', 'Unknown Product') }}</p>
    <p class="product-meta">
      {% if product.get('brand') %}
        {{ product.get('brand') }}
        {% if product.get('quantity') %} • {{ product.get('quantity') }}{% endif %}
      {% elif product.get('quantity') %}
        {{ product.get('quantity') }}
      {% endif %}
    </p>

    {% if ai_summary %}
    <div class="ai-summary-box">
      <div class="ai-summary-header">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
          <path d="M2 17l10 5 10-5"></path>
          <path d="M2 12l10 5 10-5"></path>
        </svg>
        AI Personalized Analysis
      </div>
      <p class="ai-summary-text">{{ ai_summary }}</p>
    </div>
    {% endif %}

    {% if ai_alternatives %}
    <div class="alternatives-box">
      <div class="alternatives-header">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M9 3L5 7l4 4"></path>
          <path d="M5 7h11a4 4 0 0 1 0 8h-1"></path>
          <path d="M9 21l4-4-4-4"></path>
        </svg>
        Alternative Suggestions
      </div>
      <p class="alternatives-text">{{ ai_alternatives }}</p>
    </div>
    {% endif %}

    <div class="info-section">
      <div class="info-box ingredients">
        <p><strong>Ingredients</strong></p>
        <div class="info-content ingredients-content">{{ enhanced_ingredients or product.get('important_ingredients', 'Not specified') }}</div>
      </div>

      <div class="info-box allergens">
        <p><strong>Allergens</strong></p>
        <div class="info-content allergens-content">{{ enhanced_allergens or product.get('allergens', 'None listed') }}</div>
      </div>

      <div class="info-box calories">
        <p><strong>Nutritional Information</strong></p>
        <div class="info-content calories-content">{{ enhanced_calories or (product.get('calories', 'Not specified') + ' kcal per 100g') }}</div>
      </div>
    </div>

    <div class="button-container">
      <button class="button" onclick="window.location.href='/chat'">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
        </svg>
        Chat with KenShoku
      </button>
    </div>

    <div class="footer">
      KenShoku • Your Smart Nutritionist
    </div>
  </div>

  <script>
    // Clear the context message flag so it auto-sends again when going to chat
    sessionStorage.removeItem('contextMessageSent');

    function parseMarkdown(text) {
      text = text.replace(/\\(.?)\\*/g, '<strong>$1</strong>');
      let lines = text.split('\n');
      let inList = false;
      let result = [];

      for (let line of lines) {
        if (line.trim().startsWith('-')) {
          if (!inList) {
            result.push('<ul style="margin: 8px 0; padding-left: 20px;">');
            inList = true;
          }
          result.push('<li style="margin: 4px 0;">' + line.trim().substring(1).trim() + '</li>');
        } else {
          if (inList) {
            result.push('</ul>');
            inList = false;
          }
          if (line.trim()) {
            result.push(line);
          }
        }
      }

      if (inList) {
        result.push('</ul>');
      }

      return result.join('<br>');
    }

    const aiSummaryElement = document.querySelector('.ai-summary-text');
    if (aiSummaryElement) {
      const originalText = aiSummaryElement.textContent;
      aiSummaryElement.innerHTML = parseMarkdown(originalText);
    }

    const alternativesElement = document.querySelector('.alternatives-text');
    if (alternativesElement) {
      const originalText = alternativesElement.textContent;
      alternativesElement.innerHTML = parseMarkdown(originalText);
    }

    const ingredientsElement = document.querySelector('.ingredients-content');
    if (ingredientsElement) {
      const originalText = ingredientsElement.textContent;
      ingredientsElement.innerHTML = parseMarkdown(originalText);
    }

    const allergensElement = document.querySelector('.allergens-content');
    if (allergensElement) {
      const originalText = allergensElement.textContent;
      allergensElement.innerHTML = parseMarkdown(originalText);
    }

    const caloriesElement = document.querySelector('.calories-content');
    if (caloriesElement) {
      const originalText = caloriesElement.textContent;
      caloriesElement.innerHTML = parseMarkdown(originalText);
    }
  </script>
</body>
</html>
